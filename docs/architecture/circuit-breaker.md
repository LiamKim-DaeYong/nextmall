# 서킷브레이커 최소 설계 (초안)

본 문서는 학습/포트폴리오 목적의 최소 서킷브레이커 적용 기준을 정의한다.
과한 복잡도를 피하면서도 실무 리질리언스 설계 의도를 드러내는 것을 목표로 한다.

---

## 1. 적용 범위 (최소)
- BFF → 내부 서비스 호출
- (선택) Gateway → Auth/JWKS 호출

## 2. 기본 정책 (추천값)
- 실패율 임계치(failureRateThreshold): 50%
- 느린 호출 비율(slowCallRateThreshold): 50%
- 느린 호출 기준(slowCallDurationThreshold): 2초
- 최소 호출 수(minimumNumberOfCalls): 20
- 슬라이딩 윈도 크기(slidingWindowSize): 50
- 오픈 상태 유지 시간(waitDurationInOpenState): 30초
- 하프 오픈 호출 허용 횟수(permittedNumberOfCallsInHalfOpenState): 5

## 3. 재시도/타임아웃 조합 규칙
- 타임아웃: 1~2초 내로 제한
- 재시도: 1~2회까지만 허용 (무한 재시도 금지)
- 서킷이 열림(OPEN)일 때는 즉시 실패 반환

## 4. 폴백(Fallback) 정책
- 조회(Read) 요청: 부분 응답 또는 캐시 응답 허용 여부를 명시한다
- 변경(Write) 요청: 폴백 금지 (즉시 실패 반환)
- 실패 응답은 공통 에러 포맷을 따른다

## 5. 관측 가능성 (필수 지표)
- 성공/실패 비율
- 서킷 상태 전이 횟수 (닫힘(CLOSED) → 열림(OPEN) → 반열림(HALF_OPEN))
- 타임아웃/재시도 발생 횟수

## 6. 적용 원칙
- 외부 I/O 호출에만 적용한다
- 핵심 비즈니스 로직 내부에는 적용하지 않는다
- 서킷브레이커는 “보호” 목적이지 “복구” 목적이 아니다

---

## 향후 고려사항
- 공통 설정 템플릿화 (common 모듈)
- 서비스별 정책 튜닝
- 서킷 상태 알림 연동
